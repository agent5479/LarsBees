<!DOCTYPE html>
<html>
<head>
    <title>Firebase Connection Test</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .test { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #28a745; }
        .error { background: #f8d7da; border: 1px solid #dc3545; }
        .info { background: #d1ecf1; border: 1px solid #17a2b8; }
        code { background: #e9ecef; padding: 2px 6px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üî• Firebase Connection Test</h1>
    
    <div id="results"></div>
    
    <button onclick="testWrite()">Test Write to Database</button>
    <button onclick="testRead()">Test Read from Database</button>
    <button onclick="location.href='larsbees-full.html'">Back to App</button>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <script>
        const results = document.getElementById('results');
        
        // Firebase config - Loaded from secure environment variables
        const firebaseConfig = {
            apiKey: window.ENV_FIREBASE_API_KEY,
            authDomain: window.ENV_FIREBASE_AUTH_DOMAIN,
            databaseURL: window.ENV_FIREBASE_DATABASE_URL,
            projectId: window.ENV_FIREBASE_PROJECT_ID,
            storageBucket: window.ENV_FIREBASE_STORAGE_BUCKET,
            messagingSenderId: window.ENV_FIREBASE_MESSAGING_SENDER_ID,
            appId: window.ENV_FIREBASE_APP_ID
        };
        
        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            
            results.innerHTML += '<div class="test success">‚úÖ Firebase initialized successfully!</div>';
            results.innerHTML += '<div class="test info">Database URL: <code>' + firebaseConfig.databaseURL + '</code></div>';
        } catch (error) {
            results.innerHTML += '<div class="test error">‚ùå Firebase initialization error: ' + error.message + '</div>';
        }
        
        function testWrite() {
            results.innerHTML += '<div class="test info">Testing write permissions...</div>';
            
            database.ref('test/connection').set({
                timestamp: new Date().toISOString(),
                message: 'Test write successful'
            })
            .then(() => {
                results.innerHTML += '<div class="test success">‚úÖ Write test PASSED! Database rules allow writing.</div>';
            })
            .catch((error) => {
                results.innerHTML += '<div class="test error">‚ùå Write test FAILED: ' + error.message + '</div>';
                results.innerHTML += '<div class="test error"><strong>Action needed:</strong> Update Firebase rules to allow write access!</div>';
            });
        }
        
        function testRead() {
            results.innerHTML += '<div class="test info">Testing read permissions...</div>';
            
            database.ref('test/connection').once('value')
            .then((snapshot) => {
                results.innerHTML += '<div class="test success">‚úÖ Read test PASSED! Database rules allow reading.</div>';
                if (snapshot.exists()) {
                    results.innerHTML += '<div class="test info">Data: ' + JSON.stringify(snapshot.val()) + '</div>';
                }
            })
            .catch((error) => {
                results.innerHTML += '<div class="test error">‚ùå Read test FAILED: ' + error.message + '</div>';
                results.innerHTML += '<div class="test error"><strong>Action needed:</strong> Update Firebase rules to allow read access!</div>';
            });
        }
        
        // Auto-test on load
        setTimeout(() => {
            testWrite();
            setTimeout(testRead, 1000);
        }, 1000);
    </script>
</body>
</html>

